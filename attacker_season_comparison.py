import pandas as pd
import numpy as np

season1 = pd.read_csv('attackers1718.csv')
season1 = season1.set_index(['Player','Team'])
season1['Chances'] = season1['Goals']+season1['Assists']
season2 = pd.read_csv('attackers1819.csv')
season2 = season2.set_index(['Player','Team'])
season2['Chances'] = season2['Goals']+season2['Assists']

def season_1718():
    one = season1.copy()
        
    one['Shot Conversion'] = one['Goals']/one['Shots'] #higher=better
    one['BCM per Shot'] = one['BCM']/one['Shots'] #lower=better
    one['Mins per Shot'] = one['Minutes']/one['Shots'] #lower=better
    one['Mins per Goal'] = one['Minutes']/one['Goals'] #lower=better
    one['Mins per Assist'] = one['Minutes']/one['Assists']#lower = better
    one['Mins per Chance'] = one['Minutes']/one['Chances']#lower = better
    one['Touches per Min'] = one['Touches']/one['Minutes'] #higher=better
    one['Touches per Goal'] = one['Touches']/one['Shots'] #lower=better
    one['Touches per Assist'] = one['Touches']/one['Assists']#lower = better
    one['Touches per Chance'] = one['Touches']/one['Chances']#lower = better
    one['Touches per Offside'] = one['Touches']/one['Offsides'] #higher=better
    one['Woodwork per Shots'] = one['Woodwork']/one['Shots'] #lower=better
    one['Touches per Diss'] = one['Touches']/one['Dispossessions'] #higher=better
    one['Goals to Offsides'] = one['Goals']/one['Offsides'] #higher=better
    one['Goals to BCM'] = one['Goals']/one['BCM'] #higher=better
        
    #one.drop(one.iloc[:,0:10], axis=1, inplace=True)
    
    SC_pts = pd.cut(one['Shot Conversion'],101,labels=['0','1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18','19','20','21','22','23','24','25','26','27','28','29','30','31','32','33','34','35','36','37','38','39','40','41','42','43','44','45','46','47','48','49','50','51','52','53','54','55','56','57','58','59','60','61','62','63','64','65','66','67','68','69','70','71','72','73','74','75','76','77','78','79','80','81','82','83','84','85','86','87','88','89','90','91','92','93','94','95','96','97','98','99','100'])
    BCMperS_pts = pd.cut(one['BCM per Shot'],101,labels=['100','99','98','97','96','95','94','93','92','91','90','89','88','87','86','85','84','83','82','81','80','79','78','77','76','75','74','73','72','71','70','69','68','67','66','65','64','63','62','61','60','59','58','57','56','55','54','53','52','51','50','49','48','47','46','45','44','43','42','41','40','39','38','37','36','35','34','33','32','31','30','29','28','27','26','25','24','23','22','21','20','19','18','17','16','15','14','13','12','11','10','9','8','7','6','5','4','3','2','1','0'])
    MperG_pts = pd.cut(one['Mins per Goal'],101,labels=['100','99','98','97','96','95','94','93','92','91','90','89','88','87','86','85','84','83','82','81','80','79','78','77','76','75','74','73','72','71','70','69','68','67','66','65','64','63','62','61','60','59','58','57','56','55','54','53','52','51','50','49','48','47','46','45','44','43','42','41','40','39','38','37','36','35','34','33','32','31','30','29','28','27','26','25','24','23','22','21','20','19','18','17','16','15','14','13','12','11','10','9','8','7','6','5','4','3','2','1','0'])
    MperS_pts = pd.cut(one['Mins per Shot'],101,labels=['100','99','98','97','96','95','94','93','92','91','90','89','88','87','86','85','84','83','82','81','80','79','78','77','76','75','74','73','72','71','70','69','68','67','66','65','64','63','62','61','60','59','58','57','56','55','54','53','52','51','50','49','48','47','46','45','44','43','42','41','40','39','38','37','36','35','34','33','32','31','30','29','28','27','26','25','24','23','22','21','20','19','18','17','16','15','14','13','12','11','10','9','8','7','6','5','4','3','2','1','0'])
    MperA_pts = pd.cut(one['Mins per Assist'],101,labels=['100','99','98','97','96','95','94','93','92','91','90','89','88','87','86','85','84','83','82','81','80','79','78','77','76','75','74','73','72','71','70','69','68','67','66','65','64','63','62','61','60','59','58','57','56','55','54','53','52','51','50','49','48','47','46','45','44','43','42','41','40','39','38','37','36','35','34','33','32','31','30','29','28','27','26','25','24','23','22','21','20','19','18','17','16','15','14','13','12','11','10','9','8','7','6','5','4','3','2','1','0'])
    MperC_pts = pd.cut(one['Mins per Chance'],101,labels=['100','99','98','97','96','95','94','93','92','91','90','89','88','87','86','85','84','83','82','81','80','79','78','77','76','75','74','73','72','71','70','69','68','67','66','65','64','63','62','61','60','59','58','57','56','55','54','53','52','51','50','49','48','47','46','45','44','43','42','41','40','39','38','37','36','35','34','33','32','31','30','29','28','27','26','25','24','23','22','21','20','19','18','17','16','15','14','13','12','11','10','9','8','7','6','5','4','3','2','1','0'])
    TperM_pts = pd.cut(one['Touches per Min'],101,labels=['0','1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18','19','20','21','22','23','24','25','26','27','28','29','30','31','32','33','34','35','36','37','38','39','40','41','42','43','44','45','46','47','48','49','50','51','52','53','54','55','56','57','58','59','60','61','62','63','64','65','66','67','68','69','70','71','72','73','74','75','76','77','78','79','80','81','82','83','84','85','86','87','88','89','90','91','92','93','94','95','96','97','98','99','100'])
    TperG_pts = pd.cut(one['Touches per Goal'],101,labels=['100','99','98','97','96','95','94','93','92','91','90','89','88','87','86','85','84','83','82','81','80','79','78','77','76','75','74','73','72','71','70','69','68','67','66','65','64','63','62','61','60','59','58','57','56','55','54','53','52','51','50','49','48','47','46','45','44','43','42','41','40','39','38','37','36','35','34','33','32','31','30','29','28','27','26','25','24','23','22','21','20','19','18','17','16','15','14','13','12','11','10','9','8','7','6','5','4','3','2','1','0'])
    TperA_pts = pd.cut(one['Touches per Assist'],101,labels=['100','99','98','97','96','95','94','93','92','91','90','89','88','87','86','85','84','83','82','81','80','79','78','77','76','75','74','73','72','71','70','69','68','67','66','65','64','63','62','61','60','59','58','57','56','55','54','53','52','51','50','49','48','47','46','45','44','43','42','41','40','39','38','37','36','35','34','33','32','31','30','29','28','27','26','25','24','23','22','21','20','19','18','17','16','15','14','13','12','11','10','9','8','7','6','5','4','3','2','1','0'])
    TperC_pts = pd.cut(one['Touches per Chance'],101,labels=['100','99','98','97','96','95','94','93','92','91','90','89','88','87','86','85','84','83','82','81','80','79','78','77','76','75','74','73','72','71','70','69','68','67','66','65','64','63','62','61','60','59','58','57','56','55','54','53','52','51','50','49','48','47','46','45','44','43','42','41','40','39','38','37','36','35','34','33','32','31','30','29','28','27','26','25','24','23','22','21','20','19','18','17','16','15','14','13','12','11','10','9','8','7','6','5','4','3','2','1','0'])
    TperO_pts = pd.cut(one['Touches per Offside'],101,labels=['0','1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18','19','20','21','22','23','24','25','26','27','28','29','30','31','32','33','34','35','36','37','38','39','40','41','42','43','44','45','46','47','48','49','50','51','52','53','54','55','56','57','58','59','60','61','62','63','64','65','66','67','68','69','70','71','72','73','74','75','76','77','78','79','80','81','82','83','84','85','86','87','88','89','90','91','92','93','94','95','96','97','98','99','100'])    
    WperS_pts = pd.cut(one['Woodwork per Shots'],101,labels=['100','99','98','97','96','95','94','93','92','91','90','89','88','87','86','85','84','83','82','81','80','79','78','77','76','75','74','73','72','71','70','69','68','67','66','65','64','63','62','61','60','59','58','57','56','55','54','53','52','51','50','49','48','47','46','45','44','43','42','41','40','39','38','37','36','35','34','33','32','31','30','29','28','27','26','25','24','23','22','21','20','19','18','17','16','15','14','13','12','11','10','9','8','7','6','5','4','3','2','1','0'])       
    TperD_pts = pd.cut(one['Touches per Diss'],101,labels=['0','1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18','19','20','21','22','23','24','25','26','27','28','29','30','31','32','33','34','35','36','37','38','39','40','41','42','43','44','45','46','47','48','49','50','51','52','53','54','55','56','57','58','59','60','61','62','63','64','65','66','67','68','69','70','71','72','73','74','75','76','77','78','79','80','81','82','83','84','85','86','87','88','89','90','91','92','93','94','95','96','97','98','99','100'])
    GtoO_pts = pd.cut(one['Goals to Offsides'],101,labels=['0','1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18','19','20','21','22','23','24','25','26','27','28','29','30','31','32','33','34','35','36','37','38','39','40','41','42','43','44','45','46','47','48','49','50','51','52','53','54','55','56','57','58','59','60','61','62','63','64','65','66','67','68','69','70','71','72','73','74','75','76','77','78','79','80','81','82','83','84','85','86','87','88','89','90','91','92','93','94','95','96','97','98','99','100'])
    GtoBCM_pts = pd.cut(one['Goals to BCM'],101,labels=['0','1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18','19','20','21','22','23','24','25','26','27','28','29','30','31','32','33','34','35','36','37','38','39','40','41','42','43','44','45','46','47','48','49','50','51','52','53','54','55','56','57','58','59','60','61','62','63','64','65','66','67','68','69','70','71','72','73','74','75','76','77','78','79','80','81','82','83','84','85','86','87','88','89','90','91','92','93','94','95','96','97','98','99','100'])
    
    points = pd.DataFrame([SC_pts,BCMperS_pts,MperG_pts,MperS_pts,MperA_pts,MperC_pts,TperM_pts,TperG_pts,TperA_pts,TperC_pts,TperO_pts,WperS_pts,TperD_pts,GtoO_pts,GtoBCM_pts], index=['Shot Conversion','BCM per Shot','Mins per Goal','Mins per Shot','Mins per Assist','Mins per Chance','Touches per Min','Touches per Goal','Touches per Assist','Touches per Chance','Touches per Offside','Woodwork per Shots','Touches per Diss','Goals to Offsides','Goals to BCM'])
    points = points.T
    points['Shot Conversion'] = points['Shot Conversion'].apply(np.float64)
    points['BCM per Shot'] = points['BCM per Shot'].apply(np.float64)
    points['Mins per Goal'] = points['Mins per Goal'].apply(np.float64)
    points['Mins per Shot'] = points['Mins per Shot'].apply(np.float64)
    points['Mins per Assist'] = points['Mins per Assist'].apply(np.float64)
    points['Mins per Chance'] = points['Mins per Chance'].apply(np.float64)
    points['Touches per Min'] = points['Touches per Min'].apply(np.float64)
    points['Touches per Goal'] = points['Touches per Goal'].apply(np.float64)
    points['Touches per Assist'] = points['Touches per Assist'].apply(np.float64)
    points['Touches per Chance'] = points['Touches per Chance'].apply(np.float64)
    points['Touches per Offside'] = points['Touches per Offside'].apply(np.float64)
    points['Woodwork per Shots'] = points['Woodwork per Shots'].apply(np.float64)
    points['Touches per Diss'] = points['Touches per Diss'].apply(np.float64)
    points['Goals to Offsides'] = points['Goals to Offsides'].apply(np.float64)
    points['Goals to BCM'] = points['Goals to BCM'].apply(np.float64) 
    
    player_index = (points['Mins per Goal']+points['Mins per Shot']+points['Mins per Assist']+points['Mins per Chance']+points['Shot Conversion']+points['BCM per Shot']+points['Touches per Min']+points['Touches per Goal']+points['Touches per Assist']+points['Touches per Chance']+points['Touches per Offside']+points['Woodwork per Shots']+points['Touches per Diss']+points['Goals to Offsides']+points['Goals to BCM'])
    player_index.iloc[:] = player_index.iloc[:]/player_index.max()
    #player_index.iloc[:] = player_index.iloc[:]/1500
    player_index = player_index.sort_values(ascending=False).round(3)
 
    
    return player_index


def season_1819():
    
    return 'second season'

##print(player_index)
#print(one)
print('\nAttacking player rankings and APx in Premier League 2017/18 season:\n')
print(season_1718())
##print(season1)
##print(season2)